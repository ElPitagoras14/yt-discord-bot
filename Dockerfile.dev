FROM node:24.11-bookworm

WORKDIR /app

# Capa 1: Instalar dependencias del sistema (cacheable)
RUN apt-get update && apt-get install -y \
    python3.11 \
    python3.11-distutils \
    ffmpeg \
    curl \
    && rm -rf /var/lib/apt/lists/* \
    && update-alternatives --install /usr/bin/python3 python3 /usr/bin/python3.11 1

# Capa 2: Descargar yt-dlp (cacheable)
RUN curl -L https://github.com/yt-dlp/yt-dlp/releases/latest/download/yt-dlp -o /usr/local/bin/yt-dlp && \
    chmod +x /usr/local/bin/yt-dlp

# Capa 3: Instalar dependencias npm (cacheable)
COPY package*.json ./
RUN npm ci

# Capa 4: Copiar c√≥digo fuente (se actualiza con cambios)
COPY . .

# Comando simple para desarrollo
CMD ["npm", "run", "dev"]